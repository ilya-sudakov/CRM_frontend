(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{3334:function(module,exports,__webpack_require__){var api=__webpack_require__(45),content=__webpack_require__(3335);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3335:function(module,exports,__webpack_require__){(exports=__webpack_require__(46)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.record-work{--page-items: 2;--min-height: 400px;--item-height: 160px;--buttons-height: 70px}.record-work .main-form__form{overflow-x:hidden;position:relative;overflow-y:hidden;transition:200ms ease-in-out}.record-work .main-form__form .main-form__wrapper{position:absolute;left:20px;top:70px;width:calc(100% * var(--page-items) - 30px);display:flex;flex-direction:row;justify-content:flex-start;justify-self:flex-start;align-self:start;transition:200ms ease-in-out;min-height:100%;min-height:calc(100vh - 200px)}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item{width:calc(100% / var(--page-items) - 45px);margin-right:45px;min-height:calc(100vh - 200px);height:fit-content}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item .select__options{max-height:120px}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item .select-employee{margin-bottom:10px}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item .select-work-item input:disabled{background-color:#f4f4f4}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item .select-draft__options{max-height:120px}@media (max-width: 768px){.record-work{--min-height: 725px;--item-height: 180px;--buttons-height: 200px}.record-work .main-form__form .main-form__title{font-size:140%}.record-work .main-form__form .main-form__wrapper .main-form__wrapper-item{width:calc(100% / var(--page-items) - 25px);margin-right:25px}}\n",""]),module.exports=exports},3344:function(module,exports,__webpack_require__){var api=__webpack_require__(45),content=__webpack_require__(3345);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3345:function(module,exports,__webpack_require__){(exports=__webpack_require__(46)(!1)).push([module.i,':root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.select-work-hours{width:calc(100% - 50px);display:flex;flex-direction:row;padding:25px 0;min-height:250px;padding-left:50px;position:relative}.select-work-hours__panel{background-color:#fff;color:#000;border:1px solid #4293b6;border-radius:5px;padding:25px 15px;cursor:pointer;font-size:100%;transition:0.2s ease-in-out;display:flex;flex-direction:column;justify-content:center;align-items:center;position:absolute;top:0px;right:100px;width:100%;max-width:250px}.select-work-hours__panel div{font-size:90%}.select-work-hours__panel div:nth-child(1){text-align:left;font-weight:bold;font-size:100%;width:100%}.select-work-hours__timeline{position:relative;display:flex;flex-direction:column;padding-left:80px;min-height:100%}.select-work-hours__timeline .select-work-hours__wrapper{display:flex;flex-direction:row}.select-work-hours__timeline .select-work-hours__wrapper--vertical{display:flex;flex-direction:column}.select-work-hours__timeline .select-work-hours__info{background-color:#4293b6;color:#fff;border-radius:3px;padding:10px 10px;cursor:pointer;font-size:80%;transition:0.2s ease-in-out;display:flex;flex-direction:row;justify-content:center;align-items:center;border:1px solid transparent;width:fit-content;min-width:130px;max-width:130px;margin-right:5px;box-sizing:border-box;white-space:nowrap}.select-work-hours__timeline .select-work-hours__info--inverted{background-color:#fff;color:#000;border:1px solid #4293b6}.select-work-hours__timeline .select-work-hours__line{background-color:#dedede;border-bottom-left-radius:5px;border-bottom-right-radius:5px;width:10px;height:100%;min-height:150px;margin-left:60px}.select-work-hours__list{width:100%;padding-top:80px;margin-left:-172px}.select-work-hours__list .select-work-hours__list-item{font-size:90%;margin-bottom:15px;position:relative;transition:100ms ease-in-out;display:flex;flex-direction:column;background-color:#e9e9e9;border:1px solid #cccccc;border-radius:3px;padding:10px 10px;width:100%;max-width:Min(90%, 400px);box-sizing:border-box}.select-work-hours__list .select-work-hours__list-item:hover,.select-work-hours__list .select-work-hours__list-item:focus-within{background-color:#f4f4f4}.select-work-hours__list .select-work-hours__list-item:hover .select-work-hours__work-name,.select-work-hours__list .select-work-hours__list-item:focus-within .select-work-hours__work-name{color:#666666}.select-work-hours__list .select-work-hours__list-item .select-work-hours__work-name{font-weight:500;color:#555555;padding-bottom:0;transition:100ms ease-in-out}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input{margin-top:5px;display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input span{font-size:90%;color:#444444;padding-right:10px}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input input[type="number"]{border:1px solid #bbbbbb;padding:2.5px 10px;border-radius:3px;outline:none;-moz-appearance:textfield;height:1.25rem;width:calc(60%);max-width:Max(3rem, 50px);font-size:90%}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input input[type="number"]:hover{border-color:#999999}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input input[type="number"]:focus{border:1px solid #4293b6}.select-work-hours__list .select-work-hours__list-item .select-work-hours__input input::-webkit-outer-spin-button,.select-work-hours__list .select-work-hours__list-item .select-work-hours__input input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.select-work-hours__list .select-work-hours__list-item .select-work-hours__products{margin:10px 0;padding-left:20px;font-size:90%}.select-work-hours__list .select-work-hours__list-item .select-work-hours__products li{display:flex;flex-direction:row;align-items:center;margin-bottom:5px}.select-work-hours__list .select-work-hours__list-item .select-work-hours__products li:last-child{margin-bottom:0}.select-work-hours__list .select-work-hours__list-item:last-child{margin-bottom:0}.select-work-hours__list .select-work-hours__list-item .select-work-hours__circle{content:"";position:absolute;top:3.5px;left:-50px;width:27px;height:30px;background-color:#ffffff;z-index:0;transition:100ms ease-in-out}.select-work-hours__list .select-work-hours__list-item:before{content:"";position:absolute;top:8px;left:-44px;width:10px;height:10px;border-radius:999px;border:5px solid #999999;background-color:#fafafa;z-index:1;transition:100ms ease-in-out}.select-work-hours__list .select-work-hours__list-item:after{content:"";position:absolute;top:10px;left:-11px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-right:10px solid #dfdfdf}@media (max-width: 768px){.select-work-hours{padding-left:0}.select-work-hours .select-work-hours__timeline{padding-left:0}.select-work-hours .select-work-hours__list{width:100%}.select-work-hours .select-work-hours__list .select-work-hours__list-item{max-width:Max(100%, 400px)}}\n',""]),module.exports=exports},3566:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var toConsumableArray=__webpack_require__(18),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(15),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(7),slicedToArray_default=__webpack_require__.n(slicedToArray),react=(__webpack_require__(201),__webpack_require__(23),__webpack_require__(1016),__webpack_require__(673),__webpack_require__(51),__webpack_require__(165),__webpack_require__(36),__webpack_require__(1784),__webpack_require__(0)),ErrorMessage=(__webpack_require__(3334),__webpack_require__(2854),__webpack_require__(492)),InputDate=__webpack_require__(2859),SelectEmployee=__webpack_require__(2976),SelectWork=__webpack_require__(3101),functions=(__webpack_require__(1022),__webpack_require__(473),__webpack_require__(83),__webpack_require__(474),__webpack_require__(3344),__webpack_require__(63)),jsx_runtime=__webpack_require__(1),SelectWorkHours_SelectWorkHours_SelectWorkHours=function SelectWorkHours(props){Object(react.useEffect)((function(){}),[props.workArray]);return Object(jsx_runtime.jsxs)("div",{className:"select-work-hours",children:[Object(jsx_runtime.jsxs)("div",{className:"select-work-hours__timeline",children:[Object(jsx_runtime.jsxs)("div",{className:"select-work-hours__wrapper",children:[Object(jsx_runtime.jsx)("div",{className:"select-work-hours__info",children:Object(functions.f)(props.date)}),Object(jsx_runtime.jsxs)("div",{className:"select-work-hours__info select-work-hours__info--inverted",children:["Всего часов:"," ",Math.floor(10*props.workArray.reduce((function(sum,cur){return sum+Number.parseFloat(cur.hours)}),0))/10]})]}),Object(jsx_runtime.jsx)("div",{className:"select-work-hours__line"})]}),Object(jsx_runtime.jsx)("div",{className:"select-work-hours__list",children:props.workArray.map((function(item,index){return Object(jsx_runtime.jsxs)("div",{className:"select-work-hours__list-item",children:[Object(jsx_runtime.jsx)("div",{className:"select-work-hours__circle"}),Object(jsx_runtime.jsx)("span",{className:"select-work-hours__work-name",children:item.workName}),item.product.length>0||item.draft.length>0?Object(jsx_runtime.jsxs)("ul",{className:"select-work-hours__products",children:[item.product.map((function(product){return Object(jsx_runtime.jsx)("li",{children:"".concat(product.name," - ").concat(product.quantity," шт.")},product.id)})),item.draft.map((function(draft){return Object(jsx_runtime.jsx)("li",{children:"".concat(draft.name," - ").concat(draft.quantity," шт.")},draft.id)}))]}):null,Object(jsx_runtime.jsxs)("div",{className:"select-work-hours__input",children:[Object(jsx_runtime.jsx)("span",{children:"Часы* "}),Object(jsx_runtime.jsx)("input",{type:"number",placeholder:"Введите часы...",value:item.hours.toString(),onChange:function onChange(event){return function handleWorkHoursChange(event,index,item){var value;value=event.target.value>12?12:""===event.target.value?0:Number.parseFloat(event.target.value);var curSum=props.workArray.reduce((function(sum,cur,curIndex){return index===curIndex?sum:sum+Number.parseFloat(cur.hours)}),0);curSum+value>12&&(value=Math.floor(10*(12-curSum))/10);var temp=props.workArray;temp.splice(index,1,Object.assign({},item,{hours:value})),props.onChange(toConsumableArray_default()(temp))}(event,index,item)}})]})]},item.id)}))})]})};SelectWorkHours_SelectWorkHours_SelectWorkHours.displayName="SelectWorkHours",SelectWorkHours_SelectWorkHours_SelectWorkHours.__docgenInfo={description:"",methods:[],displayName:"SelectWorkHours"};var WorkManagement_SelectWorkHours_SelectWorkHours=SelectWorkHours_SelectWorkHours_SelectWorkHours;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/GeneralPage/WorkManagement/SelectWorkHours/SelectWorkHours.jsx"]={name:"SelectWorkHours",docgenInfo:SelectWorkHours_SelectWorkHours_SelectWorkHours.__docgenInfo,path:"src/components/MainPage/GeneralPage/WorkManagement/SelectWorkHours/SelectWorkHours.jsx"});var Button=__webpack_require__(153),useProductsList=__webpack_require__(1039),RecordWork_functions=__webpack_require__(3096),hooks=__webpack_require__(1015),work_control=__webpack_require__(479),App=__webpack_require__(135),employees=__webpack_require__(231),RecordWork_NewRecordWork=function NewRecordWork(props){var _useState=Object(react.useState)({works:[]}),_useState2=slicedToArray_default()(_useState,2),worktimeInputs=_useState2[0],setWorkTimeInputs=_useState2[1],_useState3=Object(react.useState)({works:!1}),_useState4=slicedToArray_default()(_useState3,2),workTimeErrors=_useState4[0],setWorkTimeErrors=_useState4[1],_useState5=Object(react.useState)({works:!1}),_useState6=slicedToArray_default()(_useState5,2),validInputs=_useState6[0],setValidInputs=_useState6[1],userContext=Object(react.useContext)(App.a),_useState7=Object(react.useState)(!1),_useState8=slicedToArray_default()(_useState7,2),showError=_useState8[0],setShowError=_useState8[1],_useState9=Object(react.useState)(!1),_useState10=slicedToArray_default()(_useState9,2),isLoading=_useState10[0],setIsLoading=_useState10[1],_useState11=Object(react.useState)(null),_useState12=slicedToArray_default()(_useState11,2),curEmployee=_useState12[0],setCurEmployee=_useState12[1],query=Object(hooks.e)().query,_useState13=Object(react.useState)(query.get("date")?new Date(query.get("date")):new Date),_useState14=slicedToArray_default()(_useState13,2),curDate=_useState14[0],setCurDate=_useState14[1],_useProductsList=Object(useProductsList.a)(),products=_useProductsList.products,categories=_useProductsList.categories,_useState15=Object(react.useState)(0),_useState16=slicedToArray_default()(_useState15,2),totalHours=_useState16[0],setTotalHours=_useState16[1],_useState17=Object(react.useState)(0),_useState18=slicedToArray_default()(_useState17,2),curPage=_useState18[0],setCurPage=_useState18[1],_useState19=Object(react.useState)("0px"),_useState20=slicedToArray_default()(_useState19,2),wrapperHeight=_useState20[0],setWrapperHeight=_useState20[1],validateField=function validateField(fieldName,value){switch(fieldName){case"works":setValidInputs(Object.assign({},validInputs,{works:null!==value}));break;default:void 0!==validInputs[fieldName]&&setValidInputs(Object.assign({},validInputs,defineProperty_default()({},fieldName,""!==value)))}},formIsValid=function formIsValid(){var check=!0,newErrors=Object.assign({works:!1});for(var item in validInputs)!1===validInputs[item]&&(check=!1,newErrors=Object.assign(Object.assign({},newErrors,defineProperty_default()({},item,!0))));return setWorkTimeErrors(newErrors),!0===check||(setShowError(!0),!1)},handleSubmit=function handleSubmit(){return 1!==curPage?setCurPage(1):formIsValid?(setIsLoading(!0),Object(RecordWork_functions.a)(worktimeInputs,curDate,curEmployee,setIsLoading).then((function(){return props.history.push("/work-management")}))):void 0};Object(react.useEffect)((function(){document.title="Запись о работе";var abortController=new AbortController,employeeId=query.get("employee")?Number.parseInt(query.get("employee"))!==(null==curEmployee?void 0:curEmployee.id)&&null!==curEmployee?null==curEmployee?void 0:curEmployee.id:query.get("employee"):null==curEmployee?void 0:curEmployee.id;if(employeeId&&curDate&&(query.get("employee")&&null===curEmployee&&(setIsLoading(!0),Object(employees.d)(query.get("employee")).then((function(res){return res.json()})).then((function(res){return setCurEmployee(res)})).then((function(){return setIsLoading(!1)}))),!(isLoading||worktimeInputs.date===curDate&&worktimeInputs.employeeId===(null==curEmployee?void 0:curEmployee.id))))return console.log(isLoading,curEmployee,curDate,worktimeInputs),setIsLoading(!0),Object(work_control.k)(employeeId,curDate.getFullYear(),curDate.getMonth()+1,curDate.getDate()).then((function(_ref){var data=_ref.data,works=data.map((function(item){return{id:item.id,workName:item.workList.work,workId:item.workList.id,workType:item.workList.typeOfWork,hours:item.hours,comment:item.comment,isOld:!0,product:toConsumableArray_default()(item.workControlProduct.map((function(item){return{id:item.id,productId:item.product.id,name:item.product.name,quantity:item.quantity}}))),draft:toConsumableArray_default()(item.partsWorks.map((function(item){return{id:item.id,partId:item.partId,name:item.name,type:item.partType,quantity:item.quantity}})))}}));return console.log(data,works),setWorkTimeInputs(Object.assign({},worktimeInputs,{date:curDate,employeeId:Number.parseInt(employeeId),works:toConsumableArray_default()(works),originalWorks:toConsumableArray_default()(works)})),setIsLoading(!1)})).catch((function(error){console.log(error),alert("Ошибка при загрузке работы!"),props.history.push("/")})),function cancel(){abortController.abort()}}),[curEmployee,curDate]),Object(react.useEffect)((function(){var _document$getElementB;setWrapperHeight((null===(_document$getElementB=document.getElementById("".concat(curPage,"page")))||void 0===_document$getElementB?void 0:_document$getElementB.clientHeight)+"px")}));var handleClickPrevPage=function handleClickPrevPage(){0!==curPage?setCurPage(curPage-1):props.history.push("/")},screenIsMobile=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=768;return Object(jsx_runtime.jsx)("div",{className:"record-work",children:Object(jsx_runtime.jsxs)("div",{className:"main-form",children:[Object(jsx_runtime.jsx)(ErrorMessage.a,{message:"Не заполнены все обязательные поля!",showError:showError,setShowError:setShowError}),Object(jsx_runtime.jsxs)("form",{className:"main-form__form",children:[Object(jsx_runtime.jsx)("div",{className:"main-form__header main-form__header--full",children:Object(jsx_runtime.jsx)("div",{className:"main-form__title",children:"Запись о работе"})}),Object(jsx_runtime.jsx)("div",{style:{height:"calc(".concat(wrapperHeight,")")}}),Object(jsx_runtime.jsxs)("div",{className:"main-form__wrapper",style:{left:"calc(-100% * ".concat(curPage," + (").concat(screenIsMobile?"20px":"35px"," + 15px * ").concat(curPage,"))"),height:"calc(".concat(wrapperHeight,")")},children:[Object(jsx_runtime.jsxs)("div",{className:"main-form__wrapper-item",id:"0page",children:[Object(jsx_runtime.jsx)(InputDate.a,{inputName:"Дата",required:!0,name:"date",selected:curDate,handleDateChange:function handleDateChange(date){setCurDate(date)}}),Object(jsx_runtime.jsx)(SelectEmployee.a,{inputName:"Выбор сотрудника",required:!0,userHasAccess:userContext.userHasAccess,defaultValue:curEmployee,handleEmployeeChange:function handleEmployeeChange(id,name,employee){return setCurEmployee(employee)}}),Object(jsx_runtime.jsx)(SelectWork.a,{handleWorkChange:function handleWorkChange(value){validateField("works",value),setWorkTimeInputs(Object.assign({},worktimeInputs,{works:value})),setWorkTimeErrors(Object.assign({},workTimeErrors,{works:!1}))},userHasAccess:userContext.userHasAccess,defaultValue:worktimeInputs.works,totalHours:totalHours,setTotalHours:setTotalHours,categories:categories,products:products,noTime:!0,noNewItems:!curDate||!curEmployee}),Object(jsx_runtime.jsx)("div",{className:"main-form__input_hint",children:"* - поля, обязательные для заполнения"}),Object(jsx_runtime.jsxs)("div",{className:"main-form__buttons",children:[Object(jsx_runtime.jsx)(Button.a,{text:"Вернуться назад",isLoading:isLoading,className:"main-form__submit main-form__submit--inverted",inverted:!0,onClick:handleClickPrevPage}),worktimeInputs.works.length>0&&worktimeInputs.works.reduce((function(sum,cur){return"Без продукции/чертежа"===cur.workType||"Чертеж"===cur.workType?sum+1:null==cur?void 0:cur.product.length}),0)>0?Object(jsx_runtime.jsx)(Button.a,{text:"Указать часы",isLoading:isLoading,className:"main-form__submit",onClick:handleSubmit}):null]})]}),Object(jsx_runtime.jsxs)("div",{className:"main-form__wrapper-item",id:"1page",children:[Object(jsx_runtime.jsx)(WorkManagement_SelectWorkHours_SelectWorkHours,{workArray:worktimeInputs.works,date:curDate,onChange:function onChange(value){validateField("works",value),setWorkTimeInputs(Object.assign({},worktimeInputs,{works:value})),setWorkTimeErrors(Object.assign({},workTimeErrors,{works:!1}))}}),Object(jsx_runtime.jsx)("div",{className:"main-form__input_hint",children:"* - поля, обязательные для заполнения"}),Object(jsx_runtime.jsxs)("div",{className:"main-form__buttons",children:[Object(jsx_runtime.jsx)(Button.a,{text:"Вернуться назад",isLoading:isLoading,className:"main-form__submit main-form__submit--inverted",inverted:!0,onClick:handleClickPrevPage}),Object(jsx_runtime.jsx)(Button.a,{text:"Сохранить данные",isLoading:isLoading,className:"main-form__submit",onClick:handleSubmit})]})]})]})]})]})})};RecordWork_NewRecordWork.displayName="NewRecordWork",RecordWork_NewRecordWork.__docgenInfo={description:"",methods:[],displayName:"NewRecordWork"};__webpack_exports__.default=RecordWork_NewRecordWork;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/GeneralPage/WorkManagement/RecordWork/RecordWork.jsx"]={name:"NewRecordWork",docgenInfo:RecordWork_NewRecordWork.__docgenInfo,path:"src/components/MainPage/GeneralPage/WorkManagement/RecordWork/RecordWork.jsx"})}}]);