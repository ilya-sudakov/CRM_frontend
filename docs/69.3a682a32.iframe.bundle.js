(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{2862:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return defaultStylesPDF})),__webpack_require__.d(__webpack_exports__,"a",(function(){return createPDF})),__webpack_require__.d(__webpack_exports__,"d",(function(){return getPDFTitleObject})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getInputElementTextPDF})),__webpack_require__.d(__webpack_exports__,"g",(function(){return getTransportationListPdfText})),__webpack_require__.d(__webpack_exports__,"f",(function(){return getRequestPdfText})),__webpack_require__.d(__webpack_exports__,"e",(function(){return getProductsFromRequestsListPdfText}));var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__(51),__webpack_require__(36),__webpack_require__(165),__webpack_require__(475),__webpack_require__(1017),__webpack_require__(1019),__webpack_require__(2896)),pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7__),pdfmake__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2897),pdfmake__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(pdfmake__WEBPACK_IMPORTED_MODULE_8__),_functions_jsx__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(63),_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(303),defaultStylesPDF={title:{fontSize:18,alignment:"left"},subheader:{fontSize:14,alignment:"left"},regularText:{fontSize:11,alignment:"left"},tableHeader:{fontSize:11,color:"#555",alignment:"left"}},createPDF=function createPDF(data){var print=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.vfs=pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default.a.pdfMake.vfs,print?pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.createPdf(data).print():pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.createPdf(data).open()},getPDFTitleObject=function getPDFTitleObject(name){return{text:"".concat(name,"\n"),alignment:"center",style:"title"}},getInputElementTextPDF=function getInputElementTextPDF(title,value){return{text:[{text:"\n".concat(title,": \n"),style:"regularText",fontSize:12},{text:"".concat(value,"\n\n"),style:"subheader"}]}},getTransportationListPdfText=function getTransportationListPdfText(transportation){var transportationList=[],transportationInfo=[];transportation.map((function(item){return transportationInfo.push([{text:Object(_functions_jsx__WEBPACK_IMPORTED_MODULE_9__.f)(item.date),style:"regularText"},{text:item.cargo,style:"regularText"},{text:item.quantity,style:"regularText"},{text:item.sender,style:"regularText"},{text:item.recipient,style:"regularText"},{text:item.driver,style:"regularText"}])})),transportationList.push({table:{widths:[60,140,40,80,80,"*"],body:[[{text:"Дата",style:"tableHeader"},{text:"Товар",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"Откуда",style:"tableHeader"},{text:"Куда",style:"tableHeader"},{text:"Водитель",style:"tableHeader"}]].concat(transportationInfo)}});var dd={info:{title:"Реестр транспортировок"},content:[getPDFTitleObject("Реестр транспортировок")].concat(transportationList),styles:defaultStylesPDF};return pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.vfs=pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default.a.pdfMake.vfs,dd},getRequestPdfText=function getRequestPdfText(date,requestProducts,codeWord,workshopName,itemId){var productsArr=Object(_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_10__.a)(requestProducts,{fieldName:"name",direction:"asc"}).map((function(item){return[item.name,item.quantity,item.packaging,"",""]})),dd={info:{title:"Очередь производства №"+itemId},content:[getPDFTitleObject("Очередь производства  №".concat(itemId)),workshopName?getInputElementTextPDF("Подразделение",workshopName):"\n",getInputElementTextPDF("Дата",Object(_functions_jsx__WEBPACK_IMPORTED_MODULE_9__.f)(date)),{text:"Продукция: ",style:"regularText",fontSize:12,margin:[0,0,0,5]},{table:{widths:["*",70,70,70,70],body:[[{text:"Название",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"Фасовка",style:"tableHeader"},{text:"",style:"tableHeader"},{text:"",style:"tableHeader"}]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(productsArr))}},"\n",getInputElementTextPDF("Кодовое слово",codeWord)],styles:defaultStylesPDF};createPDF(dd)},sortRequestProducts=function sortRequestProducts(data){return data.sort((function(a,b){return a[0].localeCompare(b[0],void 0,{numeric:!0})<0?-1:a[0].localeCompare(b[0],void 0,{numeric:!0})>0?1:0}))},getProductsFromRequestsListPdfText=function getProductsFromRequestsListPdfText(products,workshopName){var dd={info:{title:"Очередь производства - список"},content:[getPDFTitleObject("Очередь производства - список"),workshopName?getInputElementTextPDF("Подразделение",workshopName):"\n",sortRequestProducts(Object.entries(products)).map((function(category){if(Object.values(category[1]).length>0)return[{text:[{text:"".concat(category[0]," \n"),fontSize:12,style:"regularText",margin:[5,5,5,5]}]}].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(function formatProducts(products){return[{table:{margin:[0,5,0,5],widths:["*",100,80,80],body:[[{text:"Название",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"",style:"tableHeader"},{text:"",style:"tableHeader"}]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(sortRequestProducts(Object.entries(products)).map((function(product){return[product[0],product[1],"",""]}))))}}]}(category[1])),["\n"])}))],styles:defaultStylesPDF};createPDF(dd)}},2951:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/print.2602d8cf.png"},2965:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return getTransportations})),__webpack_require__.d(__webpack_exports__,"d",(function(){return getTransportationById})),__webpack_require__.d(__webpack_exports__,"b",(function(){return deleteTransportation})),__webpack_require__.d(__webpack_exports__,"a",(function(){return addTransportation})),__webpack_require__.d(__webpack_exports__,"c",(function(){return editTransportation}));var _utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);function getTransportations(signal){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/shipping/",method:"GET",signal:signal})}function getTransportationById(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/shipping/"+id,method:"GET"})}function deleteTransportation(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/shipping/"+id,method:"DELETE"})}function addTransportation(newTransportation){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/shipping/",method:"POST",body:JSON.stringify(newTransportation)})}function editTransportation(newTransportation,id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/shipping/"+id,method:"PUT",body:JSON.stringify(newTransportation)})}},3431:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(258),__webpack_require__(671),__webpack_require__(672),__webpack_require__(83),__webpack_require__(474),__webpack_require__(201),__webpack_require__(51),__webpack_require__(165),__webpack_require__(473),__webpack_require__(23),__webpack_require__(0)),_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_15__=(__webpack_require__(3432),__webpack_require__(1782),__webpack_require__(355)),Assets_print_png__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(2951),Assets_print_png__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(Assets_print_png__WEBPACK_IMPORTED_MODULE_16__),API_transportation__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(2965),Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(2862),Utils_Form_Button_Button_jsx__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(153),Utils_MainWindow_FloatingButton_FloatingButton_jsx__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(675),Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(674),Utils_hooks_usePagination_usePagination_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1031),Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(63),Utils_hooks_useSort_useSort_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(1023),Utils_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(303),Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(356),Components_App__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(135),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(1),Transportation=function Transportation(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_12__.useState)(""),_useState2=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState,2),searchQuery=_useState2[0],setSearchQuery=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_12__.useState)([]),_useState4=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState3,2),transportation=_useState4[0],setTransportation=_useState4[1],userContext=Object(react__WEBPACK_IMPORTED_MODULE_12__.useContext)(Components_App__WEBPACK_IMPORTED_MODULE_27__.a),_useState5=Object(react__WEBPACK_IMPORTED_MODULE_12__.useState)([{name:"ЦехЛЭМЗ",visibility:["ROLE_ADMIN","ROLE_LEMZ"],senderActive:!0,recipientActive:!0},{name:"ЦехЛепсари",visibility:["ROLE_ADMIN","ROLE_LEPSARI"],senderActive:!0,recipientActive:!0},{name:"ЦехЛиговский",visibility:["ROLE_ADMIN","ROLE_LIGOVSKIY","ROLE_DISPATCHER","ROLE_MANAGER"],senderActive:!0,recipientActive:!0},{name:"Офис",visibility:["ROLE_ADMIN","ROLE_DISPATCHER","ROLE_MANAGER"],senderActive:!0,recipientActive:!0}]),_useState6=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState5,2),workshops=_useState6[0],setWorkshops=_useState6[1],_useSort=Object(Utils_hooks_useSort_useSort_js__WEBPACK_IMPORTED_MODULE_24__.a)(transportation,{},[transportation,workshops]),sortPanel=_useSort.sortPanel,sortedData=_useSort.sortedData,sortOrder=_useSort.sortOrder,handleFilterData=function handleFilterData(data){return filterTransportation(function filterSearchQuery(data){var query=searchQuery.toLowerCase();return data.filter((function(item){return item.cargo.toLowerCase().includes(query)||Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_23__.f)(item.date).includes(query)||item.sender.toLowerCase().includes(query)||item.recipient.toLowerCase().includes(query)||item.driver.toLowerCase().includes(query)||item.id.toString().includes(query)}))}(data))},filterTransportation=function filterTransportation(data){return data.filter((function(item){var senderCheck=!1,recipientCheck=!1;return workshops.map((function(workshop){workshop.senderActive&&workshop.name===item.sender&&(senderCheck=!0),workshop.recipientActive&&workshop.name===item.recipient&&(recipientCheck=!0)})),recipientCheck&&senderCheck}))},_usePagination=Object(Utils_hooks_usePagination_usePagination_js__WEBPACK_IMPORTED_MODULE_22__.a)((function(){return handleFilterData(sortedData)}),[searchQuery,sortOrder,sortedData],"static"),pagination=_usePagination.pagination,data=_usePagination.data,_useState7=Object(react__WEBPACK_IMPORTED_MODULE_12__.useState)(!0),_useState8=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState7,2),isLoading=_useState8[0],setIsLoading=_useState8[1];Object(react__WEBPACK_IMPORTED_MODULE_12__.useEffect)((function(){document.title="Реестр транспортировок";var abortController=new AbortController;return loadTransportation(abortController.signal),function cancel(){abortController.abort()}}),[]);var loadTransportation=function loadTransportation(signal){Object(API_transportation__WEBPACK_IMPORTED_MODULE_17__.e)(signal).then((function(res){return res.json()})).then((function(res){setTransportation(res),setIsLoading(!1)})).catch((function(error){setIsLoading(!1),console.log(error)}))},columns=[{text:"Дата",value:"date",formatFn:function formatFn(_ref){var date=_ref.date;return Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_23__.f)(date)}},{text:"Товар",value:"cargo"},{text:"Кол-во",value:"quantity"},{text:"Откуда",value:"sender"},{text:"Куда",value:"recipient"},{text:"Водитель",value:"driver"}];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:"transportation",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div",{className:"main-window",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(Utils_MainWindow_FloatingButton_FloatingButton_jsx__WEBPACK_IMPORTED_MODULE_20__.a,{linkTo:"/dispatcher/transportation/new",visibility:["ROLE_ADMIN","ROLE_DISPATCHER"]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:"main-window__header main-window__header--full",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:"main-window__title",children:"Реестр транспортировок"})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_15__.a,{fullSize:!0,placeholder:"Введите название товара для поиска...",setSearchQuery:setSearchQuery}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_21__.a,{buttons:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(Utils_Form_Button_Button_jsx__WEBPACK_IMPORTED_MODULE_19__.a,{text:"Печать списка",inverted:!0,imgSrc:Assets_print_png__WEBPACK_IMPORTED_MODULE_16___default.a,isLoading:isLoading,className:"main-window__button main-window__button--inverted",onClick:function printTransportationList(){var dd=Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_18__.g)(Object(Utils_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_25__.a)(filterTransportation(transportation),{fieldName:"date",direction:"desc"}));Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_18__.a)(dd)}}),sorting:sortPanel,itemsCount:"Всего: ".concat(transportation.length," записей"),content:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:"main-window__info-panel",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div",{className:"transportation__container",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("span",{children:"Фильтр по подразделениям"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div",{className:"main-window__filter-pick",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("span",{className:"transportation__text",children:"Откуда: "}),workshops.map((function(item,index){if(userContext.userHasAccess(item.visibility))return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:item.senderActive?"main-window__button":"main-window__button main-window__button--inverted",onClick:function onClick(){var temp=workshops;temp.splice(index,1,Object.assign({},temp[index],{name:item.name,senderActive:!item.senderActive})),setWorkshops(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(temp))},children:item.name})}))]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsxs)("div",{className:"main-window__filter-pick",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("span",{className:"transportation__text",children:"Куда: "}),workshops.map((function(item,index){if(userContext.userHasAccess(item.visibility))return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)("div",{className:item.recipientActive?"main-window__button":"main-window__button main-window__button--inverted",onClick:function onClick(){var temp=workshops;temp.splice(index,1,Object.assign({},temp[index],{name:item.name,recipientActive:!item.recipientActive})),setWorkshops(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(temp))},children:item.name})}))]})]})})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_28__.jsx)(Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_26__.a,{columns:columns,data:data,loading:{isLoading:isLoading},actions:function actions(item){return[{elementType:"edit",title:"Редактировать запись",link:"/dispatcher/transportation/edit/".concat(item.id)},{elementType:"delete",title:"Удаление задачи",onClick:function onClick(){return function deleteItem(id){Object(API_transportation__WEBPACK_IMPORTED_MODULE_17__.b)(id).then((function(){return loadTransportation()}))}(item.id)},isRendered:userContext.userHasAccess(["ROLE_ADMIN"])}]}}),pagination]})})};Transportation.displayName="Transportation",Transportation.__docgenInfo={description:"",methods:[],displayName:"Transportation"},__webpack_exports__.default=Transportation,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/Dispatcher/Transportation/Transportation.jsx"]={name:"Transportation",docgenInfo:Transportation.__docgenInfo,path:"src/components/MainPage/Dispatcher/Transportation/Transportation.jsx"})},3432:function(module,exports,__webpack_require__){var api=__webpack_require__(45),content=__webpack_require__(3433);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3433:function(module,exports,__webpack_require__){(exports=__webpack_require__(46)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.transportation .main-window__filter-pick{margin-top:5px;margin-bottom:5px;flex-wrap:wrap}.transportation .main-window__filter-pick .checkbox{margin-right:auto;margin-left:15px}.transportation .main-window__filter-pick .checkbox__container{width:100%;padding-left:30px}.transportation .main-window__filter-pick .checkbox__container input:checked ~ .checkbox__checkmark{background-color:#4293b6}.transportation .transportation__container{margin-top:10px;width:100%}.transportation .transportation__text{width:50px;text-align:right;padding-right:10px}.transportation .main-window__button{text-align:center;white-space:nowrap}@media (max-width: 768px){.transportation .main-window__info-panel{flex-direction:column !important}.transportation .transportation__container{text-align:center}.transportation .main-window__filter-pick .checkbox{margin-top:5px}.transportation .main-window__filter-pick .main-window__button{margin-top:5px}.transportation .main-window__filter-pick .main-window__button:last-child{margin-right:0}}\n",""]),module.exports=exports}}]);