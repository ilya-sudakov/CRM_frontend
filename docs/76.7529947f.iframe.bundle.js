(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{2656:function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(40),__webpack_require__(0)),Assets_tableview_chevron_down_inline_svg__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(985),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=(__webpack_require__(2661),__webpack_require__(1)),ControlPanel=function ControlPanel(props){var _props$styles,_useState=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),_useState2=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(_useState,2),isHidden=_useState2[0],setIsHidden=_useState2[1];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"control-panel",style:Object.assign({},null!==(_props$styles=props.styles)&&void 0!==_props$styles?_props$styles:{}),children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"main-window__control-panel-wrapper",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"control-panel__buttons",children:[props.sorting||null,props.content?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"main-window__button main-window__button--inverted main-window__button--filter",onClick:function onClick(){return setIsHidden((function(isHidden){return!isHidden}))},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{children:props.panelName||"Фильтры"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(Assets_tableview_chevron_down_inline_svg__WEBPACK_IMPORTED_MODULE_3__.a,{className:"main-window__img ".concat(isHidden?"":"main-window__img--rotated")})]}):null,props.buttons||null,props.itemsCount?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"main-window__amount_table",children:props.itemsCount}):null]}),isHidden?null:props.content]})})};ControlPanel.displayName="ControlPanel",ControlPanel.__docgenInfo={description:"",methods:[],displayName:"ControlPanel"},__webpack_exports__.a=ControlPanel,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/utils/MainWindow/ControlPanel/ControlPanel.jsx"]={name:"ControlPanel",docgenInfo:ControlPanel.__docgenInfo,path:"src/utils/MainWindow/ControlPanel/ControlPanel.jsx"})},2661:function(module,exports,__webpack_require__){var api=__webpack_require__(47),content=__webpack_require__(2662);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},2662:function(module,exports,__webpack_require__){(exports=__webpack_require__(48)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.control-panel{width:100%}.control-panel .main-window__control-panel-wrapper{padding-top:5px;padding-bottom:10px}.control-panel .main-window__control-panel-wrapper .control-panel__buttons{display:flex;flex-direction:row;flex-wrap:wrap;width:100%}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__button{margin-top:5px;padding:8px 10px;font-size:85%}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .switch{margin-top:5px;margin-right:10px}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .searchbar{max-width:50%;margin-right:auto;padding:0;align-self:center;margin-left:-15px}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__amount_table{color:#666666;align-self:center;margin-top:5px;margin-left:auto}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window{padding:0}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__sort-panel{width:max-content;margin-bottom:0;margin-right:10px;box-sizing:border-box;padding-top:calc(5px);position:relative;background-color:#ffffff}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__sort-panel::before{width:100%;height:20px;position:absolute;content:\"Сортировка\";top:8px;left:10px;z-index:0;color:#777777;font-size:95%}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__sort-panel select{padding-top:18px;padding-right:25px;padding-left:9px;height:100%;margin:0;box-sizing:border-box;min-width:150px;z-index:0;background-color:transparent;cursor:pointer;border:1px solid #cccccc;transition:background-color 100ms ease-in-out;-webkit-appearance:none;-moz-appearance:none;background:transparent;background-image:url(\"data:image/svg+xml;utf8,<svg fill='black' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z'></path></svg>\");background-repeat:no-repeat;background-position-x:100%;background-position-y:calc(50% + 2px)}.control-panel .main-window__control-panel-wrapper .main-window__button--filter{border-color:#cccccc;justify-content:space-between;padding:8px 8px !important;padding-right:5px !important}.control-panel .main-window__control-panel-wrapper .main-window__button--filter span{margin-right:20px;font-size:95%}.control-panel .main-window__control-panel-wrapper .main-window__button--filter .main-window__img{filter:none;max-width:18px;margin-top:1px;margin-right:0;transition:200ms cubic-bezier(0.23, 1, 0.32, 1)}.control-panel .main-window__control-panel-wrapper .main-window__button--filter .main-window__img path:nth-child(1){transition:200ms cubic-bezier(0.23, 1, 0.32, 1);fill:#333333}@media (max-width: 768px){.control-panel .main-window__control-panel-wrapper{padding-left:15px;padding-right:15px}.control-panel .main-window__control-panel-wrapper .control-panel__buttons{width:calc(100% + 30px);padding:0 15px;box-sizing:border-box;flex-wrap:nowrap;margin-left:-15px;overflow:auto;white-space:nowrap}.control-panel .main-window__control-panel-wrapper .control-panel__buttons .main-window__sort-panel select{padding-top:18px !important;padding-right:25px !important;padding-left:9px !important;max-width:240px}}\n",""]),module.exports=exports},2709:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return getUsers})),__webpack_require__.d(__webpack_exports__,"d",(function(){return getUserById})),__webpack_require__.d(__webpack_exports__,"b",(function(){return deleteUser})),__webpack_require__.d(__webpack_exports__,"c",(function(){return editUser})),__webpack_require__.d(__webpack_exports__,"a",(function(){return addUser}));var _utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(632);function getUsers(signal){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/",method:"GET",signal:signal})}function getUserById(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"GET"})}function deleteUser(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"DELETE"})}function editUser(newUser,id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"PUT",body:JSON.stringify(newUser)})}function addUser(newUser){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/",method:"POST",body:JSON.stringify(newUser)})}},3429:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(65),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(15),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(631),__webpack_require__(633),__webpack_require__(634),__webpack_require__(147),__webpack_require__(987),__webpack_require__(281),__webpack_require__(40),__webpack_require__(983),__webpack_require__(0)),_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_13__=(__webpack_require__(3430),__webpack_require__(1590),__webpack_require__(637)),Utils_RequestsAPI_users__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(2709),Utils_MainWindow_FloatingPlus_FloatingPlus_jsx__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(639),Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(2656),Utils_hooks_useSort_useSort__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(2682),Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(643),Components_App__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(214),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(1),Users=function Users(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)(""),_useState2=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState,2),searchQuery=_useState2[0],setSearchQuery=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)([]),_useState4=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState3,2),users=_useState4[0],setUsers=_useState4[1],_useState5=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)(!1),_useState6=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1],userContext=Object(react__WEBPACK_IMPORTED_MODULE_10__.useContext)(Components_App__WEBPACK_IMPORTED_MODULE_19__.a),_useSort=Object(Utils_hooks_useSort_useSort__WEBPACK_IMPORTED_MODULE_17__.a)(users,{ignoreURL:!1,sortOrder:{curSort:"username",username:"asc"},sortOptions:[{value:"username asc",text:"По имени (А-Я)"},{value:"username desc",text:"По имени (Я-А)"}]},[users]),sortPanel=_useSort.sortPanel,sortedData=_useSort.sortedData,_useState7=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)([{name:"Руководитель",role:"ROLE_ADMIN",visible:!1},{name:"Инженер",role:"ROLE_ENGINEER",visible:!1},{name:"Менеджер1",role:"ROLE_MANAGER",visible:!1},{name:"ЦехЛЭМЗ",role:"ROLE_LEMZ",visible:!1},{name:"ЦехЛепсари",role:"ROLE_LEPSARI",visible:!1},{name:"ЦехЛиговский",role:"ROLE_LIGOVSKIY",visible:!1},{name:"Диспетчер",role:"ROLE_DISPATCHER",visible:!1}]),_useState8=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState7,2),userRoles=_useState8[0],setUserRoles=_useState8[1];Object(react__WEBPACK_IMPORTED_MODULE_10__.useEffect)((function(){document.title="Управление пользователями";var abortController=new AbortController;return loadUsers(abortController.signal),function cancel(){abortController.abort()}}),[]);var loadUsers=function loadUsers(signal){setIsLoading(!0),Object(Utils_RequestsAPI_users__WEBPACK_IMPORTED_MODULE_14__.e)(signal).then((function(res){return res.json()})).then((function(response){setUsers(response),setIsLoading(!1)})).catch((function(error){console.log(error),setIsLoading(!1)}))},roles={ROLE_ADMIN:"Руководитель",ROLE_MANAGER:"Менеджер",ROLE_DISPATCHER:"Диспетчер",ROLE_LEMZ:"ЦехЛЭМЗ",ROLE_LEPSARI:"ЦехЛепсари",ROLE_LIGOSVKIY:"ЦехЛиговский",ROLE_ENGINEER:"Инженер1"},columns=[{text:"Имя пользователя",value:"username"},{text:"Эл. почта",value:"email"},{text:"Роль",value:"roles",formatFn:function formatUserRole(_ref){var _roles$find,role=null===(_roles$find=_ref.roles.find((function(item){return item.name})))||void 0===_roles$find?void 0:_roles$find.name;return roles[role]}}];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"users-manage",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"main-window",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_MainWindow_FloatingPlus_FloatingPlus_jsx__WEBPACK_IMPORTED_MODULE_15__.a,{linkTo:"/profile/users/new",visibility:["ROLE_ADMIN"]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__header main-window__header--full",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__title",children:"Управление пользователями"})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_13__.a,{fullSize:!0,placeholder:"Введите имя пользователя для поиска...",setSearchQuery:setSearchQuery}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_16__.a,{itemsCount:"Всего: ".concat(users.length," записей"),sorting:sortPanel,content:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__info-panel",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"main-window__filter-pick",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{children:"Фильтр по ролям: "}),userRoles.map((function(role,index){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:(role.visible?"main-window__button":"main-window__button main-window__button--inverted")+" main-window__list-item--"+role.className,onClick:function onClick(){var temp=userRoles.map((function(role){return Object.assign({},role,{visible:!1})}));temp.splice(index,1,Object.assign({},role,{visible:!role.visible})),setUserRoles(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(temp))},children:role.name},index)}))]})})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_18__.a,{columns:columns,data:function filterUsersByRoles(data){return function filterSearchQuery(data){return data.filter((function(item){return item.username.toLowerCase().includes(searchQuery.toLowerCase())}))}(data).filter((function(item){var check=!1,noActiveRoles=!0;return userRoles.map((function(role){userRoles.map((function(role){role.visible&&(noActiveRoles=!1)})),(!0===noActiveRoles||role.visible&&void 0!==item.roles.find((function(roleTemp){return roleTemp.name===role.role})))&&(check=!0)})),check}))}(sortedData),loading:{isLoading:isLoading},actions:function actions(item){return[{elementType:"edit",title:"Редактировать пользователя",link:"/profile/users/edit/".concat(item.id)},{elementType:"delete",title:"Удаление пользователя",onClick:function onClick(){return function deleteItem(id){Object(Utils_RequestsAPI_users__WEBPACK_IMPORTED_MODULE_14__.b)(id).then((function(){return loadUsers()}))}(item.id)},isRendered:userContext.userHasAccess(["ROLE_ADMIN"])}]}})]})})};Users.displayName="Users",Users.__docgenInfo={description:"",methods:[],displayName:"Users"},__webpack_exports__.default=Users,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/Profile/Users/Users.jsx"]={name:"Users",docgenInfo:Users.__docgenInfo,path:"src/components/MainPage/Profile/Users/Users.jsx"})},3430:function(module,exports,__webpack_require__){var api=__webpack_require__(47),content=__webpack_require__(3431);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3431:function(module,exports,__webpack_require__){(exports=__webpack_require__(48)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.users-manage .control-panel .main-window__info-panel{margin-bottom:0;margin-top:10px}.users-manage .control-panel .main-window__info-panel .main-window__filter-pick{margin-bottom:0}\n",""]),module.exports=exports}}]);