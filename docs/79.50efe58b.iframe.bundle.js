(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{2869:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return getUsers})),__webpack_require__.d(__webpack_exports__,"d",(function(){return getUserById})),__webpack_require__.d(__webpack_exports__,"b",(function(){return deleteUser})),__webpack_require__.d(__webpack_exports__,"c",(function(){return editUser})),__webpack_require__.d(__webpack_exports__,"a",(function(){return addUser}));var _utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);function getUsers(signal){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/",method:"GET",signal:signal})}function getUserById(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"GET"})}function deleteUser(id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"DELETE"})}function editUser(newUser,id){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/"+id,method:"PUT",body:JSON.stringify(newUser)})}function addUser(newUser){return Object(_utilsAPI_jsx__WEBPACK_IMPORTED_MODULE_0__.b)({url:Object({NODE_ENV:"production",NODE_PATH:[],STORYBOOK:"true",PUBLIC_URL:"."}).API_BASE_URL+"/api/v1/admin/user/",method:"POST",body:JSON.stringify(newUser)})}},3427:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(255),__webpack_require__(660),__webpack_require__(661),__webpack_require__(50),__webpack_require__(1007),__webpack_require__(162),__webpack_require__(23),__webpack_require__(465),__webpack_require__(0)),_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_13__=(__webpack_require__(3428),__webpack_require__(1762),__webpack_require__(348)),API_users__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(2869),Utils_MainWindow_FloatingButton_FloatingButton_jsx__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(664),Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(663),Utils_hooks_useSort_useSort__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(1012),Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(349),Components_App__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(132),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(1),Users=function Users(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)(""),_useState2=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState,2),searchQuery=_useState2[0],setSearchQuery=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)([]),_useState4=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState3,2),users=_useState4[0],setUsers=_useState4[1],_useState5=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)(!1),_useState6=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1],userContext=Object(react__WEBPACK_IMPORTED_MODULE_10__.useContext)(Components_App__WEBPACK_IMPORTED_MODULE_19__.a),_useSort=Object(Utils_hooks_useSort_useSort__WEBPACK_IMPORTED_MODULE_17__.a)(users,{ignoreURL:!1,sortOrder:{curSort:"username",username:"asc"},sortOptions:[{value:"username asc",text:"По имени (А-Я)"},{value:"username desc",text:"По имени (Я-А)"}]},[users]),sortPanel=_useSort.sortPanel,sortedData=_useSort.sortedData,_useState7=Object(react__WEBPACK_IMPORTED_MODULE_10__.useState)([{name:"Руководитель",role:"ROLE_ADMIN",visible:!1},{name:"Инженер",role:"ROLE_ENGINEER",visible:!1},{name:"Менеджер1",role:"ROLE_MANAGER",visible:!1},{name:"ЦехЛЭМЗ",role:"ROLE_LEMZ",visible:!1},{name:"ЦехЛепсари",role:"ROLE_LEPSARI",visible:!1},{name:"ЦехЛиговский",role:"ROLE_LIGOVSKIY",visible:!1},{name:"Диспетчер",role:"ROLE_DISPATCHER",visible:!1}]),_useState8=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1___default()(_useState7,2),userRoles=_useState8[0],setUserRoles=_useState8[1];Object(react__WEBPACK_IMPORTED_MODULE_10__.useEffect)((function(){document.title="Управление пользователями";var abortController=new AbortController;return loadUsers(abortController.signal),function cancel(){abortController.abort()}}),[]);var loadUsers=function loadUsers(signal){setIsLoading(!0),Object(API_users__WEBPACK_IMPORTED_MODULE_14__.e)(signal).then((function(res){return res.json()})).then((function(response){setUsers(response),setIsLoading(!1)})).catch((function(error){console.log(error),setIsLoading(!1)}))},roles={ROLE_ADMIN:"Руководитель",ROLE_MANAGER:"Менеджер",ROLE_DISPATCHER:"Диспетчер",ROLE_LEMZ:"ЦехЛЭМЗ",ROLE_LEPSARI:"ЦехЛепсари",ROLE_LIGOSVKIY:"ЦехЛиговский",ROLE_ENGINEER:"Инженер1"},columns=[{text:"Имя пользователя",value:"username"},{text:"Эл. почта",value:"email"},{text:"Роль",value:"roles",formatFn:function formatUserRole(_ref){var _roles$find,role=null===(_roles$find=_ref.roles.find((function(item){return item.name})))||void 0===_roles$find?void 0:_roles$find.name;return roles[role]}}];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"users-manage",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"main-window",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_MainWindow_FloatingButton_FloatingButton_jsx__WEBPACK_IMPORTED_MODULE_15__.a,{linkTo:"/profile/users/new",visibility:["ROLE_ADMIN"]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__header main-window__header--full",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__title",children:"Управление пользователями"})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_13__.a,{fullSize:!0,placeholder:"Введите имя пользователя для поиска...",setSearchQuery:setSearchQuery}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_16__.a,{itemsCount:"Всего: ".concat(users.length," записей"),sorting:sortPanel,content:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__info-panel",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"main-window__filter-pick",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{children:"Фильтр по ролям: "}),userRoles.map((function(role,index){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:(role.visible?"main-window__button":"main-window__button main-window__button--inverted")+" main-window__list-item--"+role.className,onClick:function onClick(){var temp=userRoles.map((function(role){return Object.assign({},role,{visible:!1})}));temp.splice(index,1,Object.assign({},role,{visible:!role.visible})),setUserRoles(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(temp))},children:role.name},index)}))]})})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Components_Table_Table_jsx__WEBPACK_IMPORTED_MODULE_18__.a,{columns:columns,data:function filterUsersByRoles(data){return function filterSearchQuery(data){return data.filter((function(item){return item.username.toLowerCase().includes(searchQuery.toLowerCase())}))}(data).filter((function(item){var check=!1,noActiveRoles=!0;return userRoles.map((function(role){userRoles.map((function(role){role.visible&&(noActiveRoles=!1)})),(!0===noActiveRoles||role.visible&&void 0!==item.roles.find((function(roleTemp){return roleTemp.name===role.role})))&&(check=!0)})),check}))}(sortedData),loading:{isLoading:isLoading},actions:function actions(item){return[{elementType:"edit",title:"Редактировать пользователя",link:"/profile/users/edit/".concat(item.id)},{elementType:"delete",title:"Удаление пользователя",onClick:function onClick(){return function deleteItem(id){Object(API_users__WEBPACK_IMPORTED_MODULE_14__.b)(id).then((function(){return loadUsers()}))}(item.id)},isRendered:userContext.userHasAccess(["ROLE_ADMIN"])}]}})]})})};Users.displayName="Users",Users.__docgenInfo={description:"",methods:[],displayName:"Users"},__webpack_exports__.default=Users,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/Profile/Users/Users.jsx"]={name:"Users",docgenInfo:Users.__docgenInfo,path:"src/components/MainPage/Profile/Users/Users.jsx"})},3428:function(module,exports,__webpack_require__){var api=__webpack_require__(44),content=__webpack_require__(3429);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3429:function(module,exports,__webpack_require__){(exports=__webpack_require__(45)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}.users-manage .control-panel .main-window__info-panel{margin-bottom:0;margin-top:10px}.users-manage .control-panel .main-window__info-panel .main-window__filter-pick{margin-bottom:0}\n",""]),module.exports=exports}}]);