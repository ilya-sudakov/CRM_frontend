(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{2862:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return defaultStylesPDF})),__webpack_require__.d(__webpack_exports__,"a",(function(){return createPDF})),__webpack_require__.d(__webpack_exports__,"d",(function(){return getPDFTitleObject})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getInputElementTextPDF})),__webpack_require__.d(__webpack_exports__,"g",(function(){return getTransportationListPdfText})),__webpack_require__.d(__webpack_exports__,"f",(function(){return getRequestPdfText})),__webpack_require__.d(__webpack_exports__,"e",(function(){return getProductsFromRequestsListPdfText}));var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__(51),__webpack_require__(36),__webpack_require__(165),__webpack_require__(475),__webpack_require__(1017),__webpack_require__(1019),__webpack_require__(2896)),pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7__),pdfmake__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2897),pdfmake__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(pdfmake__WEBPACK_IMPORTED_MODULE_8__),_functions_jsx__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(63),_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(303),defaultStylesPDF={title:{fontSize:18,alignment:"left"},subheader:{fontSize:14,alignment:"left"},regularText:{fontSize:11,alignment:"left"},tableHeader:{fontSize:11,color:"#555",alignment:"left"}},createPDF=function createPDF(data){var print=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.vfs=pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default.a.pdfMake.vfs,print?pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.createPdf(data).print():pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.createPdf(data).open()},getPDFTitleObject=function getPDFTitleObject(name){return{text:"".concat(name,"\n"),alignment:"center",style:"title"}},getInputElementTextPDF=function getInputElementTextPDF(title,value){return{text:[{text:"\n".concat(title,": \n"),style:"regularText",fontSize:12},{text:"".concat(value,"\n\n"),style:"subheader"}]}},getTransportationListPdfText=function getTransportationListPdfText(transportation){var transportationList=[],transportationInfo=[];transportation.map((function(item){return transportationInfo.push([{text:Object(_functions_jsx__WEBPACK_IMPORTED_MODULE_9__.f)(item.date),style:"regularText"},{text:item.cargo,style:"regularText"},{text:item.quantity,style:"regularText"},{text:item.sender,style:"regularText"},{text:item.recipient,style:"regularText"},{text:item.driver,style:"regularText"}])})),transportationList.push({table:{widths:[60,140,40,80,80,"*"],body:[[{text:"Дата",style:"tableHeader"},{text:"Товар",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"Откуда",style:"tableHeader"},{text:"Куда",style:"tableHeader"},{text:"Водитель",style:"tableHeader"}]].concat(transportationInfo)}});var dd={info:{title:"Реестр транспортировок"},content:[getPDFTitleObject("Реестр транспортировок")].concat(transportationList),styles:defaultStylesPDF};return pdfmake__WEBPACK_IMPORTED_MODULE_8___default.a.vfs=pdfmake_build_vfs_fonts_js__WEBPACK_IMPORTED_MODULE_7___default.a.pdfMake.vfs,dd},getRequestPdfText=function getRequestPdfText(date,requestProducts,codeWord,workshopName,itemId){var productsArr=Object(_sorting_sorting_js__WEBPACK_IMPORTED_MODULE_10__.a)(requestProducts,{fieldName:"name",direction:"asc"}).map((function(item){return[item.name,item.quantity,item.packaging,"",""]})),dd={info:{title:"Очередь производства №"+itemId},content:[getPDFTitleObject("Очередь производства  №".concat(itemId)),workshopName?getInputElementTextPDF("Подразделение",workshopName):"\n",getInputElementTextPDF("Дата",Object(_functions_jsx__WEBPACK_IMPORTED_MODULE_9__.f)(date)),{text:"Продукция: ",style:"regularText",fontSize:12,margin:[0,0,0,5]},{table:{widths:["*",70,70,70,70],body:[[{text:"Название",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"Фасовка",style:"tableHeader"},{text:"",style:"tableHeader"},{text:"",style:"tableHeader"}]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(productsArr))}},"\n",getInputElementTextPDF("Кодовое слово",codeWord)],styles:defaultStylesPDF};createPDF(dd)},sortRequestProducts=function sortRequestProducts(data){return data.sort((function(a,b){return a[0].localeCompare(b[0],void 0,{numeric:!0})<0?-1:a[0].localeCompare(b[0],void 0,{numeric:!0})>0?1:0}))},getProductsFromRequestsListPdfText=function getProductsFromRequestsListPdfText(products,workshopName){var dd={info:{title:"Очередь производства - список"},content:[getPDFTitleObject("Очередь производства - список"),workshopName?getInputElementTextPDF("Подразделение",workshopName):"\n",sortRequestProducts(Object.entries(products)).map((function(category){if(Object.values(category[1]).length>0)return[{text:[{text:"".concat(category[0]," \n"),fontSize:12,style:"regularText",margin:[5,5,5,5]}]}].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(function formatProducts(products){return[{table:{margin:[0,5,0,5],widths:["*",100,80,80],body:[[{text:"Название",style:"tableHeader"},{text:"Кол-во",style:"tableHeader"},{text:"",style:"tableHeader"},{text:"",style:"tableHeader"}]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(sortRequestProducts(Object.entries(products)).map((function(product){return[product[0],product[1],"",""]}))))}}]}(category[1])),["\n"])}))],styles:defaultStylesPDF};createPDF(dd)}},2899:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return filterEmployeesBySearchQuery})),__webpack_require__.d(__webpack_exports__,"b",(function(){return getEmployeesByWorkshopListPdfText})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getEmployeesListPdfText}));var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(258),__webpack_require__(165),__webpack_require__(671),__webpack_require__(672),__webpack_require__(83),__webpack_require__(474),__webpack_require__(201),__webpack_require__(36),__webpack_require__(51),__webpack_require__(63)),Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2862),filterEmployeesBySearchQuery=function filterEmployeesBySearchQuery(data,searchQuery){var query=searchQuery.toLowerCase();return data.filter((function(item){return null!==item.name&&(item.lastName.toLowerCase().includes(query)||item.name.toLowerCase().includes(query)||item.middleName.toLowerCase().includes(query)||item.id.toString().includes(query)||item.yearOfBirth&&item.yearOfBirth.toString().includes(query)||item.dateOfBirth&&item.dateOfBirth.toString().includes(query)||item.citizenship.toLowerCase().includes(query)||item.workshop.toLowerCase().includes(query)||item.position.toLowerCase().includes(query)||item.comment.toLowerCase().includes(query)||item.relevance.toLowerCase().includes(query))}))},getEmployeesTablePDF=function getEmployeesTablePDF(employeeInfo){return{table:{widths:["*",70,80,120,100],body:[[{text:"ФИО",style:"tableHeader"},{text:"Дата рождения",style:"tableHeader"},{text:"Гражданство",style:"tableHeader"},{text:"Должность",style:"tableHeader"},{text:"",style:"tableHeader"}]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(employeeInfo))}}},getEmployeesByWorkshopListPdfText=function getEmployeesByWorkshopListPdfText(){var employees=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],workshop=arguments.length>1?arguments[1]:void 0,employeesList=[],employeeInfo=[];employees.map((function(item){employeeInfo.push([Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_10__.o)(item),Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_10__.f)(item.yearOfBirth),item.citizenship,item.position,""])})),employeesList.push(getEmployeesTablePDF(employeeInfo));var dd={info:{title:"Список сотрудников - ".concat(workshop)},content:[Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.d)("Список сотрудников ".concat(workshop,"\n"))].concat(employeesList),styles:Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.b};Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.a)(dd)},getEmployeesListPdfText=function getEmployeesListPdfText(employees,workshops){var employeesList=[];workshops.map((function(workshop){employeesList.push(Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.c)("Подразделение",workshop));var employeeInfo=[];employees.map((function(employee){(workshop===employee.workshop&&"Уволен"!==employee.relevance||"Уволенные"===workshop&&"Уволен"===employee.relevance)&&employeeInfo.push([Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_10__.o)(employee),Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_10__.f)(employee.yearOfBirth),employee.citizenship,employee.position,""])})),employeesList.push(getEmployeesTablePDF(employeeInfo))}));var dd={info:{title:"Список сотрудников"},content:[Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.d)("Список сотрудников")].concat(employeesList),styles:Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.b};Object(Utils_pdfFunctions_js__WEBPACK_IMPORTED_MODULE_11__.a)(dd)}},2951:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/print.2602d8cf.png"},2957:function(module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(258),__webpack_require__(165),__webpack_require__(36),__webpack_require__(51),__webpack_require__(23),__webpack_require__(0)),Utils_hooks__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1015),Utils_sorting_sorting__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(303),_App__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(135),_functions__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(2899),Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(63),workshops=[{name:"ЦехЛЭМЗ"},{name:"ЦехЛепсари"},{name:"ЦехЛиговский"},{name:"Офис"},{name:"Уволенные"}],filterEmployees=function filterEmployees(data,workshopItem){return data.filter((function(employee){return workshopItem===employee.workshop&&"Уволен"!==employee.relevance||"Уволенные"===workshopItem&&"Уволен"===employee.relevance}))},sortEmployees=function sortEmployees(data,searchQuery){return Object(Utils_sorting_sorting__WEBPACK_IMPORTED_MODULE_8__.a)(Object(_functions__WEBPACK_IMPORTED_MODULE_10__.a)(data,searchQuery),{fieldName:"lastName",direction:"asc"})};__webpack_exports__.a=function TableView(_ref){var isLoading=_ref.isLoading,searchQuery=_ref.searchQuery,employees=_ref.employees,deleteItem=_ref.deleteItem,onSelect=_ref.onSelect,userContext=Object(react__WEBPACK_IMPORTED_MODULE_6__.useContext)(_App__WEBPACK_IMPORTED_MODULE_9__.a),columns=[{text:"Подразделение",value:"name",itemsCount:function itemsCount(item){return"Уволенные"!==item.name?filterEmployees(employees,item.name).length:null}}],nestedColumns=[{text:"ФИО",value:"lastName",formatFn:function formatFn(item){return"".concat(item.lastName," ").concat(item.name," ").concat(item.middleName)}},{text:"Дата рождения",value:"dateOfBirth",formatFn:function formatFn(_ref2){var dateOfBirth=_ref2.dateOfBirth;return Object(Utils_functions_jsx__WEBPACK_IMPORTED_MODULE_11__.f)(dateOfBirth)}},{text:"Гражданство",value:""},{text:"Должность",value:"position"}],data=onSelect?Object(react__WEBPACK_IMPORTED_MODULE_6__.useMemo)((function(){return sortEmployees(employees,searchQuery)}),[employees,isLoading,searchQuery]):Object(react__WEBPACK_IMPORTED_MODULE_6__.useMemo)((function(){return workshops.map((function(workshop){return Object.assign({},workshop,{employees:sortEmployees(filterEmployees(employees,workshop.name),searchQuery)})}))}),[employees,isLoading,searchQuery]),_useTable=Object(Utils_hooks__WEBPACK_IMPORTED_MODULE_7__.h)({data:data,isLoading:isLoading,onClick:onSelect?function(item){return onSelect(item)}:void 0,columns:onSelect?nestedColumns:columns,actions:onSelect?void 0:function actions(item){return[{onClick:function onClick(){return Object(_functions__WEBPACK_IMPORTED_MODULE_10__.b)(item.employees,item.name)},icon:"print",text:"Печать",isOutside:!0}]},nestedTable:onSelect?void 0:{isLoading:isLoading,columns:nestedColumns,actions:function actionsNested(item){return[{elementType:"edit",title:"Редактирование сотрудника",link:"/dispatcher/employees/edit/".concat(item.id),isRendered:userContext.userHasAccess(["ROLE_ADMIN","ROLE_DISPATCHER","ROLE_ENGINEER","ROLE_WORKSHOP"])},{elementType:"delete",title:"Удаление сотрудника",onClick:function onClick(){return deleteItem(item.id)},isRendered:userContext.userHasAccess(["ROLE_ADMIN"])}]},fieldName:"employees"},options:onSelect?{fullSize:!0}:void 0});return _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(_useTable,1)[0]}},3449:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(51),__webpack_require__(36),__webpack_require__(134),__webpack_require__(83),__webpack_require__(166),__webpack_require__(154),__webpack_require__(202),__webpack_require__(258),__webpack_require__(0)),_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(3450),__webpack_require__(1782),__webpack_require__(355)),Assets_print_png__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(2951),Assets_print_png__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(Assets_print_png__WEBPACK_IMPORTED_MODULE_13__),_functions_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(2899),API_employees__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(231),Utils_Form_Button_Button_jsx__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(153),Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(674),Utils_sorting_sorting__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(303),_TableView_jsx__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(2957),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(1),Employees=function Employees(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_9__.useState)(""),_useState2=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(_useState,2),searchQuery=_useState2[0],setSearchQuery=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_9__.useState)(!1),_useState4=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1],_useState5=Object(react__WEBPACK_IMPORTED_MODULE_9__.useState)([]),_useState6=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(_useState5,2),employees=_useState6[0],setEmployees=_useState6[1],workshops=["ЦехЛЭМЗ","ЦехЛепсари","ЦехЛиговский","Офис","Уволенные"];Object(react__WEBPACK_IMPORTED_MODULE_9__.useEffect)((function(){document.title="Сотрудники";var abortController=new AbortController;return loadEmployees(abortController.signal),function cancel(){abortController.abort()}}),[]);var loadEmployees=function loadEmployees(signal){setIsLoading(!0);var emplArr=[],temp=workshops.map((function(item){var workshop={workshop:item};return Object(API_employees__WEBPACK_IMPORTED_MODULE_15__.h)(workshop,signal).then((function(res){return res.json()})).then((function(res){res.map((function(item){return emplArr.push(item)})),setEmployees([].concat(emplArr))}))}));Promise.all(temp).then((function(){setIsLoading(!1)})).catch((function(error){console.log(error),setIsLoading(!1)}))};return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"employees",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div",{className:"main-window",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__header main-window__header--full",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div",{className:"main-window__title",children:"Сотрудники"})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_SearchBar_SearchBar_jsx__WEBPACK_IMPORTED_MODULE_12__.a,{fullSize:!0,placeholder:"Введите фамилию сотрудника для поиска...",setSearchQuery:setSearchQuery}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_MainWindow_ControlPanel_ControlPanel_jsx__WEBPACK_IMPORTED_MODULE_17__.a,{buttons:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(Utils_Form_Button_Button_jsx__WEBPACK_IMPORTED_MODULE_16__.a,{text:"Печать списка",isLoading:isLoading,imgSrc:Assets_print_png__WEBPACK_IMPORTED_MODULE_13___default.a,inverted:!0,className:"main-window__button main-window__button--inverted",onClick:function printEmployeesList(){Object(_functions_js__WEBPACK_IMPORTED_MODULE_14__.c)(Object(Utils_sorting_sorting__WEBPACK_IMPORTED_MODULE_18__.a)(employees,{fieldName:"lastName",direction:"asc"}),workshops)}}),itemsCount:"Всего: ".concat(employees.filter((function(employee){return"Уволен"!==employee.relevance&&"Уволенные"!==employee.workshop})).length," записей")}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_TableView_jsx__WEBPACK_IMPORTED_MODULE_19__.a,{employees:employees,isLoading:isLoading,searchQuery:searchQuery,deleteItem:function deleteItem(id){Object(API_employees__WEBPACK_IMPORTED_MODULE_15__.b)(id).then((function(){return loadEmployees()}))}})]})})};Employees.displayName="Employees",Employees.__docgenInfo={description:"",methods:[],displayName:"Employees"},__webpack_exports__.default=Employees,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MainPage/Dispatcher/Employees/Employees.jsx"]={name:"Employees",docgenInfo:Employees.__docgenInfo,path:"src/components/MainPage/Dispatcher/Employees/Employees.jsx"})},3450:function(module,exports,__webpack_require__){var api=__webpack_require__(45),content=__webpack_require__(3451);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},3451:function(module,exports,__webpack_require__){(exports=__webpack_require__(46)(!1)).push([module.i,":root{--accent-color--light: #f8f1f1;--accent-color--contrast: #16c79a;--main-color: #4293b6;--main-color--dark: #19456b}\n",""]),module.exports=exports}}]);